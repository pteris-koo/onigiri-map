<!DOCTYPE html>
<html>
<head>
  <title>大阪のおにぎり屋MAP</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #map {
      height: 80vh;  /* 画面高さの80% */
      width: 100%;
    }

    @media (max-width: 768px) {
      #map {
        height: 60vh; /* スマホは少し低め */
      }
      .leaflet-popup-content {
        font-size: 14px;
        max-width: 200px;
      }
    }
  </style>
</head>
<body>
  <h2>大阪のおにぎり屋MAP</h2>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script>

  <script>
    // 初期ズームは画面幅で調整
    const zoomLevel = window.innerWidth < 768 ? 11 : 10;
    const map = L.map('map').setView([34.693763, 135.502191], zoomLevel);

    const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
    const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');

    osmLayer.addTo(map);

    L.control.layers({
      "OpenStreetMap": osmLayer,
      "航空写真": satelliteLayer
    }).addTo(map);

    // アイコンサイズを画面幅で変える
    const iconSize = window.innerWidth < 768 ? [20, 20] : [25, 25];
    const customIcon = L.icon({
      iconUrl: 'images/onigiri.png', // index.html から見た相対パス
      iconSize: iconSize,
      iconAnchor: [iconSize[0]-5, iconSize[1]-5],
      popupAnchor: [0, -iconSize[1]+5]
    });

    // CSV読み込み
    Papa.parse("data/onigiri_osaka.csv", {
      download: true,
      header: true,
      complete: function(results) {
        results.data.forEach(shop => {
          if (shop.lat && shop.lng) {
            L.marker([parseFloat(shop.lat), parseFloat(shop.lng)], { icon: customIcon })
              .addTo(map)
              .bindPopup(`<strong><a href="${shop.link}" target="_blank">${shop.name}</a></strong>`);
          }
        });
      }
    });
  </script>
</body>
</html>
